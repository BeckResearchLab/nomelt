schema: '2.0'
stages:
  prepare_data:
    cmd: python scripts/prepare_data.py
    deps:
    - path: ./data/database.ddb
      hash: md5
      md5: b51482d0b753298b2bd522729dc69767
      size: 14074523648
    - path: ./nomelt/deduplication.py
      hash: md5
      md5: 43a77592878fbad6b852803f56c01114
      size: 13055
    - path: ./scripts/prepare_data.py
      hash: md5
      md5: b1a40147ee479aa314a50e20f70932bc
      size: 7789
    params:
      params.yaml:
        data.dev_sample_data: 10000
        data.keep_only_extremes: false
        data.kgram: 4
        data.min_align_cov: 0.95
        data.min_temp_diff: 35.0
        data.min_thermo_temp: 65.0
        data.minhash_num_perm: 128
        data.minhash_threshold: 0.2
        data.test_size: 0.1
    outs:
    - path: ./data/data_metrics.yaml
      hash: md5
      md5: 025c860ac5057f5b8db49821abdd9227
      size: 86
    - path: ./data/dataset/
      hash: md5
      md5: f3fea8fad4ebf84a9d9b7936b1fc49b9.dir
      size: 4371087
      nfiles: 10
  train:
    cmd: python scripts/train.py
    deps:
    - path: ./data/dataset/
      hash: md5
      md5: 699d36354e65b4863fe734558ccc2be9.dir
      size: 711790148
      nfiles: 10
    - path: ./scripts/train.py
      hash: md5
      md5: a01aae0c98b49c89401988a74049afc1
      size: 10028
    params:
      params.yaml:
        model.model_hyperparams:
          dropout_rate: 0.1
        model.pretrained_model: ./data/nomelt-model/model/
        model.task: translation
        training.dev_sample_data: 12
        training.epochs: 5
        training.fp16: false
        training.gradient_accumulation: 1
        training.gradient_checkpointing: true
        training.keep_only_extremes: false
        training.label_smoothing_factor: 0.0
        training.learning_rate: 0.0001
        training.lr_scheduler_type: linear
        training.max_length: 250
        training.optim: adafactor
        training.optim_args: scale_parameter=False,relative_step=False
        training.per_device_batch_size: 12
        training.saves_per_epoch:
        training.warmup_ratio: 0.1
    outs:
    - path: ./data/nomelt-model/live/metrics.json
      hash: md5
      md5: 792fed40d1df6d4444e465dd40ff503a
      size: 611
    - path: ./data/nomelt-model/live/report.md
      hash: md5
      md5: f4eaafe9402104939f41536e8250ac00
      size: 1906
    - path: ./data/nomelt-model/live/static/
      hash: md5
      md5: b284e8ccdef55fd21a5ef2a0556b2a7b.dir
      size: 370819
      nfiles: 17
    - path: ./data/nomelt-model/model/
      hash: md5
      md5: 9854d2f6dde30755ddd55392b9124733.dir
      size: 33855985216
      nfiles: 38
